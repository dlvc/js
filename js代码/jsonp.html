<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        const $ = {
            ajax(options) {
                const url = options.url;
                const type = options.type;
                const dataType = options.dataType;
                //判断是否同源
                //获取目标url的域
                let targetProtocol = ''; //目标接口的协议
                let targetHost = ''; //目标接口的host，host是包含域名和端口的
                if(url.indexOf('http://') == 0 || url.indexOf('https://') == 0) {
                    const targetUrl = new URL(url);
                    targetProtocol = targetUrl.protocol;
                    targetHost = targetUrl.host;
                } else {
                    targetProtocol = location.protocol;
                    targetHost = location.host;
                }
                //判断是否为jsonp
                if(dataType == 'jsonp') {
                    //是否同源
                    if(location.protocol == targetProtocol && location.host == targetHost) {
                        //此处省略
                    }else {
                        //不同源跨域
                        //随机生成一个callback
                        const callback = 'cb' + Math.floor(Math.random() * 100000);
                        window[callback] = options.success;
                        //生成script标签
                        const script = document.createElement('script');
                        if(url.indexOf('?') > 0) {
                            script.src = url + '&callback=' + callback;                            
                        }else {
                            script.src = url + '?callback=' + callback;
                        }
                        script.id = callback;
                        document.head.appendChild(script);
                    }
                }
            }
        }
        $.ajax({
            url: 'https://developer.duyiedu.com/edu/testJsonp',
            type: 'get',
            dataType: 'jsonp',
            success(data) {
                console.log(data);
            }
        })
    </script>
</body>
</html>