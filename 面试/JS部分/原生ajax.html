<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>原生ajax</title>
	</head>
	<body>
		<script>
			function ajax(options) {
				let method = options.method.toUpperCase() || 'GET',
					params = options.params,
					data = options.data,
					url = `${options.url}${
						params
							? '?' +
							  Object.keys(params)
									.map(k => k + '=' + params[k])
									.join('&')
							: ''
					}`,
					headers = options.headers

				let xhr
				if (window.XMLHttpRequest) {
					xhr = new XMLHttpRequest()
				} else {
					xhr = new ActiveXObject('Microsoft.XMLHTTP')
				}

				return new Promise((resolve, reject) => {
					xhr.onreadystatechange = function() {
						if (xhr.readyState === 4 && xhr.status === 200) {
							resolve(JSON.parse(xhr.responseText))
						} else reject()
					}
					xhr.open(method, url)

					if (headers) {
						Object.keys(headers).forEach(key =>
							xhr.setRequestHeader(key, headers[key])
						)
					}

					xhr.send(data)
				}).catch(value => {
					// console.log(value)
				})
			}

			ajax({
				method: 'GET',
				params: {
					name: 'panda',
					msg: 'hello'
				},
				url: ' https://developer.duyiedu.com/edu/groupChat/sendMsg'
			}).then(value => {
				console.log(value)
			})
		</script>
	</body>
</html>
